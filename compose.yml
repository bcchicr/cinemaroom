services:
  gateway:
    profiles:
      - app
      - backend
    build:
      context: ./
      dockerfile: ./.docker/gateway/Dockerfile
      target: app_php_dev
      args:
        - ALPINE_VERSION
        - PHP_VERSION
        - COMPOSER_VERSION
        - PHP_EXT_INSTALLER_VERSION
        - PROTOC_VERSION
        - UID
        - GID
    volumes:
      - ./services/gateway:/app
      - ./lib/proto:/lib/proto
    ports:
      - ${NETWORK_INTERFACE:-127.0.0.1}:${GATEWAY_PORT:-8000}:9501
    networks:
      - cinemaroom
    env_file: ./lib/.common.env
    entrypoint: entrypoint.sh

  user:
    build:
      context: ./
      dockerfile: ./.docker/user/Dockerfile
      target: app_php_dev
      args:
        - ALPINE_VERSION
        - PHP_VERSION
        - COMPOSER_VERSION
        - PHP_EXT_INSTALLER_VERSION
        - ROADRUNNER_VERSION
        - PROTOC_VERSION
        - GOLANG_VERSION
        - UID
        - GID
    volumes:
      - ./services/user:/app
      - ./lib/proto:/lib/proto
    ports:
      - ${NETWORK_INTERFACE:-127.0.0.1}:${USER_SERVICE_PORT:-8002}:8080
    networks:
      - cinemaroom
    env_file: ./lib/.common.env
    environment:
      RR_CONFIG_FILE: ${USER_RR_CONFIG_FILE}
    entrypoint: entrypoint.sh

networks:
  cinemaroom:
    name: cinemaroom